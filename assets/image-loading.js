(()=>{var h=t=>requestAnimationFrame(t),w=(t,n)=>{h(()=>{let s=t();h(()=>n(s))})};var b=(t,n={})=>{let a={...{root:null,rootMargin:"100px",threshold:.01},...n},e=null,r=()=>e||(e=new IntersectionObserver(t,a),e);return{init:r,destroy:()=>{e?.disconnect(),e=null},observe:u=>{e||r(),e?.observe(u)},unobserve:u=>{e?.unobserve(u)},get observer(){return e}}};var v=()=>{let t=new Map;return{register:(e,r)=>{if(typeof r=="function")if(t.set(e,r),window.themeCleanup){let c=window.themeCleanup;window.themeCleanup=()=>{r(),c()}}else window[`cleanup${e}`]=r},cleanup:e=>{let r=t.get(e);r&&(r(),t.delete(e))},cleanupAll:()=>{t.forEach((e,r)=>{try{e()}catch{}}),t.clear()},get registered(){return Array.from(t.keys())}}};var m=t=>{if(!t)return!1;let n=t.getBoundingClientRect();return n.top>=0&&n.left>=0&&n.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&n.right<=(window.innerWidth||document.documentElement.clientWidth)},g=()=>{if(!navigator.connection)return!1;let t=navigator.connection.effectiveType;return t==="2g"||t==="slow-2g"},f=()=>"fetchPriority"in HTMLImageElement.prototype;var l={selectors:{main:".image-main",placeholder:".image-placeholder",wrapper:".image-wrapper"},attr:{mainSrcset:"data-srcset",sourceSrcset:"data-source-srcset"},classes:{hidden:"hidden",loaded:"loaded",main:"image-main"}},S=()=>{let t=new Map;return{init:()=>{let e=document.querySelectorAll(l.selectors.wrapper);return t.set("wrappers",Array.from(e)),t.get("wrappers").length>0},get:e=>t.get(e),cleanup:()=>{t.clear()}}},I=()=>{let t=e=>{"decode"in e&&e.decode().catch(()=>{})},n=(e,r)=>{w(()=>{let o=e.closest(l.selectors.wrapper);if(!o)return null;let u=o.querySelectorAll(`source[${l.attr.sourceSrcset}]`),p=Array.from(u).map(d=>({element:d,dataSrc:d.getAttribute(l.attr.sourceSrcset)})).filter(d=>d.dataSrc),y=e.getAttribute(l.attr.mainSrcset);return{sourcesData:p,mainSrcset:y,isInViewport:r,mainImage:e}},o=>{o&&(o.sourcesData.forEach(({element:u,dataSrc:p})=>{u.setAttribute("srcset",p),u.removeAttribute(l.attr.sourceSrcset),"importance"in u&&(u.importance=o.isInViewport&&!g()?"high":"low")}),o.mainSrcset&&(o.mainImage.setAttribute("srcset",o.mainSrcset),o.mainImage.removeAttribute(l.attr.mainSrcset),o.mainImage.decoding=o.isInViewport?"sync":"async",f()&&(o.mainImage.fetchPriority=o.isInViewport?"high":"low"),"importance"in o.mainImage&&(o.mainImage.importance=o.isInViewport?"high":"auto"),(o.isInViewport||o.mainImage.complete)&&t(o.mainImage)))})},s=(e,r,c)=>{if(n(e,c),e.classList.remove(l.classes.hidden),e.classList.add(l.classes.loaded),!r)return;r.style.opacity="0";let i=()=>r.remove();r.addEventListener("transitionend",i,{once:!0,passive:!0})};return{loadImage:(e,r=null)=>{if(!e.classList.contains(l.classes.main)||!e.classList.contains(l.classes.hidden))return;let c=e.closest(l.selectors.wrapper),i=c&&c.querySelector(l.selectors.placeholder);!c||!i||(r===null&&(r=m(e)),g()&&f()&&(e.fetchPriority="low"),e.complete?s(e,i,r):e.addEventListener("load",()=>{s(e,i,r)},{once:!0}))}}},C=t=>({processImages:(s,a)=>{s.forEach(e=>{let r=e.querySelector(l.selectors.main),c=e.querySelector(l.selectors.placeholder);if(!r||!c||!r.classList.contains(l.classes.hidden))return;let i=m(r);i?t.loadImage(r,i):a.observe(r)})}}),x=t=>{let n=null,s=c=>{c.forEach(i=>{i.isIntersecting&&(t.loadImage(i.target),n.unobserve(i.target))})};return{init:()=>{n=b(s),n.init()},getObserver:()=>n,destroy:()=>{n&&(n.destroy(),n=null)}}},A=()=>{let t=S(),n=null,s=null,a=null,e=()=>{if(!t.init())return null;n=I(),s=C(n),a=x(n),a.init();let c=t.get("wrappers"),i=a.getObserver();return s.processImages(c,i),r},r=()=>{a?.destroy(),t?.cleanup(),n=null,s=null,a=null};return{init:e}},O=()=>{let t=v(),s=A().init();s&&t.register("ImageLoadingAPI",s)};O();})();
