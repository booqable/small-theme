import{frameSequence as e,cleanupSystem as n,intersectionObserver as r,inViewport as t,slowConnection as s,hasFetchPriority as a}from"utils.js";const l={t:{l:".image-main",placeholder:".image-placeholder",o:".image-wrapper"},i:{u:"data-srcset",m:"data-source-srcset"},p:{hidden:"hidden",loaded:"loaded",l:"image-main"}},o=()=>{const e=new Map;return{init:()=>{const n=document.querySelectorAll(l.t.o);return e.set("wrappers",Array.from(n)),e.get("wrappers").length>0},get:n=>e.get(n),h:()=>{e.clear()}}},c=()=>{const n=(n,r,t)=>{((n,r)=>{e(()=>{const e=n.closest(l.t.o);if(!e)return null;const t=e.querySelectorAll(`source[${l.i.m}]`);return{I:Array.from(t).map(e=>({element:e,dataSrc:e.getAttribute(l.i.m)})).filter(e=>e.dataSrc),u:n.getAttribute(l.i.u),S:r,v:n}},e=>{var n;e&&(e.I.forEach(({element:n,dataSrc:r})=>{n.setAttribute("srcset",r),n.removeAttribute(l.i.m),"A"in n&&(n.A=e.S&&!s()?"high":"low")}),e.u&&(e.v.setAttribute("srcset",e.u),e.v.removeAttribute(l.i.u),e.v.decoding=e.S?"sync":"async",a()&&(e.v.fetchPriority=e.S?"high":"low"),"A"in e.v&&(e.v.A=e.S?"high":"auto"),(e.S||e.v.complete)&&"decode"in(n=e.v)&&n.decode().catch(()=>{})))})})(n,t),n.classList.remove(l.p.hidden),n.classList.add(l.p.loaded),r&&(r.style.opacity="0",r.addEventListener("transitionend",()=>r.remove(),{once:!0,passive:!0}))};return{j:(e,r=null)=>{if(!e.classList.contains(l.p.l))return;if(!e.classList.contains(l.p.hidden))return;const o=e.closest(l.t.o),c=o&&o.querySelector(l.t.placeholder);o&&c&&(null===r&&(r=t(e)),s()&&a()&&(e.fetchPriority="low"),e.complete?n(e,c,r):e.addEventListener("load",()=>{n(e,c,r)},{once:!0}))}}},i=e=>({D:(n,r)=>{n.forEach(n=>{const s=n.querySelector(l.t.l),a=n.querySelector(l.t.placeholder);if(!s||!a)return;if(!s.classList.contains(l.p.hidden))return;const o=t(s);o?e.j(s,o):r.observe(s)})}}),u=e=>{let n=null;const t=r=>{r.forEach(r=>{r.isIntersecting&&(e.j(r.target),n.unobserve(r.target))})};return{init:()=>{n=r(t),n.init()},L:()=>n,destroy:()=>{n&&(n.destroy(),n=null)}}},d=()=>{const e=o();let n=null,r=null,t=null;const s=()=>{t?.destroy(),e?.h(),n=null,r=null,t=null};return{init:()=>{if(!e.init())return null;n=c(),r=i(n),t=u(n),t.init();const a=e.get("wrappers"),l=t.L();return r.D(a,l),s}}},m=()=>{const e=n(),r=d().init();r&&e.register("ImageLoadingAPI",r)};m();