import{frameSequence as e,resizeObserver as n,cleanupSystem as r,setCssVar as t,getDimensions as o}from"utils.js";const i={t:{o:'input[type="checkbox"]',i:document.documentElement,u:".header",l:".header__icons",p:".header__logo",h:".preview-bar__container",m:{container:".header__menu-nav",opener:"#header-opener-menu",label:'label[for="header-opener-menu"]',v:".has-dropdown"},search:{container:".search__wrapper",opener:"#header-opener-search",label:'label[for="header-opener-search"]'}},H:{active:"active"},O:{_:"--header-height",k:"--preview-height",transitionDuration:"--transition-duration"},C:992,T:0},a=()=>{const e=new Map,n=new Map([["headerHeight",0],["previewHeight",0]]);return{init:n=>(e.set("doc",i.t.i),e.set("header",n),e.set("preview",document.querySelector(i.t.h)),null!==e.get("header")),get:n=>e.get(n),M:(e,r)=>{n.set(e,r)},$:()=>{e.clear(),n.clear()}}},c=n=>{const r=()=>{n.get("header")&&e(()=>{const e=n.get("header"),r=n.get("preview"),t=o(e);let i={height:0};return r&&(i=o(r)),{_:t.height,k:i.height}},e=>{const{_:r,k:o}=e,a=n.get("doc");t(i.O._,`${r}px`,a),n.M("headerHeight",r),!n.get("preview")||o<=0||(t(i.O.k,`${o}px`,a),n.M("previewHeight",o))})};return{A:r,D:r}},s=e=>{let r=null;return{init:()=>{e.A(),r=n(()=>e.D(),{T:i.T}),r.init()},destroy:()=>{r?.destroy(),r=null}}},u=()=>{const e=a();let n=null,r=null;const t=()=>{r?.destroy(),e?.$(),n=null,r=null};return{init:()=>{const o=document.querySelector(i.t.u);return o&&e.init(o)?(n=c(e),r=s(n),r.init(),t):null},destroy:t}},l=()=>{const e=new Map;let n=null,r=null,t=null;const o=()=>t&&t.matches,a=()=>{r&&(clearTimeout(r),r=null)},c=(r,t)=>!(!r||!r.checked||(r.checked=!1,((r,t=!1)=>{const o=`container_${r}`;let a=e.get(o);if(null===a)return!1;if(!a){if(a=document.querySelector(r),!a)return e.set(o,null),!1;e.set(o,a)}const c=a.querySelectorAll(i.t.o);if(!c.length)return!1;const s=()=>{c.forEach(e=>{e.checked&&(e.checked=!1)})};if(!t)return s(),!0;const u=(()=>{if(null!==n)return n;const e=i.O.transitionDuration,r=getComputedStyle(i.t.i).getPropertyValue(e).trim();let t=0;return r&&(r.endsWith("ms")?t=parseFloat(r):r.endsWith("s")&&(t=1e3*parseFloat(r))),n=t,t})();setTimeout(s,u)})(t,!0),0)),s=(e,n,r)=>t=>{if(!e||!e.checked)return!1;const o=t.target.closest(n),i=t.target.closest(r),a=t.target===e;if(o||i||a)return!1;c(e,n)},u=n=>{n.matches&&(()=>{const n=e.get("menuOpener");n&&n.checked&&c(n,i.t.m.container)})()},l=n=>{if(!o())return;const r=e.get("searchOpener");r&&r.checked&&n.target.closest(i.t.m.v)&&c(r,i.t.search.container)};return{init:()=>{if(e.set("menuOpener",document.querySelector(i.t.m.opener)),e.set("searchOpener",document.querySelector(i.t.search.opener)),e.set("menuContainer",document.querySelector(i.t.m.container)),!e.get("menuOpener")&&!e.get("searchOpener"))return!1;const n=s(e.get("menuOpener"),i.t.m.container,i.t.m.label),c=s(e.get("searchOpener"),i.t.search.container,i.t.search.label),d=r=>{e.get("menuOpener")&&n(r),e.get("searchOpener")&&c(r)};document.addEventListener("click",d,{passive:!0}),t=window.matchMedia(`(min-width: ${i.C}px)`),t.addEventListener("change",u);const p=e.get("menuContainer");return p&&(p.addEventListener("mouseover",l,{passive:!0}),(()=>{if(!o())return;const n=e.get("menuContainer");if(!n)return;const t=n.querySelectorAll(i.t.m.v);if(!t.length)return;const c=i.H.active,s=Array.from(t);t.forEach(n=>{const t=()=>{a(),s.forEach(e=>{e.classList.remove(c)}),n.classList.add(c)},o=()=>{a(),r=setTimeout(()=>{n.classList.remove(c)},500)};n.addEventListener("mouseenter",t,{passive:!0}),n.addEventListener("mouseleave",o,{passive:!0}),e.has("dropdownHandlers")||e.set("dropdownHandlers",[]),e.get("dropdownHandlers").push({element:n,F:t,I:o})})})()),e.set("clickOutside",d),!0},destroy:()=>{const r=e.get("clickOutside");r&&document.removeEventListener("click",r),t&&(t.removeEventListener("change",u),t=null),a();const o=e.get("menuContainer");o&&(o.removeEventListener("mouseover",l),(()=>{const n=e.get("dropdownHandlers");n&&(n.forEach(({element:e,F:n,I:r})=>{e.removeEventListener("mouseenter",n),e.removeEventListener("mouseleave",r)}),e.delete("dropdownHandlers"))})()),n=null,e.clear()}}},d=()=>{const e=r(),n=u().init();if(!n)return;e.register("HeaderAPI",n);const t=l();t.init(),e.register("MenuAPI",t.destroy)};d();