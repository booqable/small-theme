import{frameSequence as t,cleanupSystem as n,intersectionObserver as e}from"utils.js";const l={t:{image:".focal-image"},l:{o:"data-focal-x",u:"data-focal-y",i:"data-focal-processed"},m:"50% 50%"},r=()=>{const t=new Map,n=new Map;return{init:()=>{const n=document.querySelectorAll(l.t.image);return t.set("images",Array.from(n)),t.get("images").length>0},get:n=>t.get(n),p:t=>n.get(t),$:(t,e)=>{n.set(t,e)},h:()=>{t.clear(),n.clear()}}},a=t=>{const n=t=>{const n=50*((parseFloat(t)||0)+1);return`${Math.max(0,Math.min(100,n))}%`};return{M:(e,r)=>{if(null===e||null===r)return l.m;const a=`${e}_${r}`;let o=t.p(a);return o||(o=`${n(e)} ${n(r)}`,t.$(a,o)),o}}},o=n=>({P:e=>{if("true"===e.getAttribute(l.l.i))return;const r=e.getAttribute(l.l.o),a=e.getAttribute(l.l.u);if(null===r||null===a)return;const o=n.M(r,a);t(()=>({image:e,position:o}),t=>{t.image.style.objectPosition=t.position,t.image.style.opacity="1",t.image.setAttribute(l.l.i,"true")})}}),u=t=>({F:(t,n)=>{t.forEach(t=>{"true"!==t.getAttribute(l.l.i)&&n.observe(t)})}}),s=t=>{let n=null;const l=e=>{e.forEach(e=>{e.isIntersecting&&(t.P(e.target),n.unobserve(e.target))})};return{init:()=>{n=e(l),n.init()},I:()=>n,destroy:()=>{n&&(n.destroy(),n=null)}}},c=()=>{const t=r();let n=null,e=null,l=null,c=null;const i=()=>{c?.destroy(),t?.h(),n=null,e=null,l=null,c=null};return{init:()=>{if(!t.init())return null;n=a(t),e=o(n),l=u(),c=s(e),c.init();const r=t.get("images"),f=c.I();return l.F(r,f),i}}},i=()=>{const t=n(),e=c().init();e&&t.register("FocalImageAPI",e)};i();