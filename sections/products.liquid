{%- if section.blocks.size > 0 -%}
  {%- assign color_scheme           = section.settings.color_scheme -%}
  {%- assign content_horizontal     = section.settings.content_horizontal -%}
  {%- assign loading_strategy       = 'lazy' -%}
  {%- assign padding_bottom_desktop = section.settings.padding_bottom_desktop -%}
  {%- assign padding_bottom_mobile  = section.settings.padding_bottom_mobile -%}
  {%- assign padding_top_desktop    = section.settings.padding_top_desktop -%}
  {%- assign padding_top_mobile     = section.settings.padding_top_mobile -%}
  {%- assign products_group         = false -%}
  {%- assign products_layout        = section.settings.products_layout -%}

  {%- if section_preview -%}
    {%- assign loading_strategy     = 'eager' -%}
  {%- endif -%}

  {% comment %} CSS variables start {% endcomment %}
  {%- capture variables -%}
    {%- case padding_bottom_desktop -%}
      {%- when 'md' -%}
        --padding-bottom-desktop: 60px;
      {%- when 'lg' -%}
        --padding-bottom-desktop: 80px;
    {%- endcase -%}

    {%- case padding_bottom_mobile -%}
      {%- when 'md' -%}
        --padding-bottom-mobile: 32px;
      {%- when 'lg' -%}
        --padding-bottom-mobile: 50px;
    {%- endcase -%}

    {%- case padding_top_desktop -%}
      {%- when 'md' -%}
        --padding-top-desktop: 60px;
      {%- when 'lg' -%}
        --padding-top-desktop: 80px;
    {%- endcase -%}

    {%- case padding_top_mobile -%}
      {%- when 'md' -%}
        --padding-top-mobile: 32px;
      {%- when 'lg' -%}
        --padding-top-mobile: 50px;
    {%- endcase -%}

    {%- case content_horizontal -%}
      {%- when 'center' -%}
        --products-content-alignment: center;
        --products-content-text-alignment: center;
      {%- when 'right' -%}
        --products-content-alignment: flex-end;
        --products-content-text-alignment: right;
    {%- endcase -%}

    {%- case products_layout -%}
      {%- when 'three' -%}
        --products-layout-desktop: 3;
    {%- endcase -%}
  {%- endcapture -%}
  {% comment %} CSS variables end {% endcomment %}

  <div class="products__wrapper products__wrapper--padding-top products__wrapper--padding-bottom color-{{- color_scheme.id -}}"
    style="{{- variables | escape -}}"
  >
    <div class="products__container container">
      <div class="products__content">
        {%- for block in section.blocks -%}
          {%- assign block_id = block.id -%}

          {%- case block.type -%}
            {%- when 'description' -%}
              {%- if products_group -%}
                </div>

                {%- assign products_group = false -%}
              {%- endif -%}

              {%- assign description = block.settings.description -%}

              {%- if description != blank -%}
                <div class="products__description" id="{{- block_id -}}">
                  {{- description -}}
                </div>
              {%- endif -%}

            {%- when 'heading' -%}
              {%- if products_group -%}
                </div>

                {%- assign products_group = false -%}
              {%- endif -%}

              {%- assign heading = block.settings.heading -%}

              {%- if heading != blank -%}
                <h2 class="products__heading" id="{{- block_id -}}">
                  {{- heading -}}
                </h2>
              {%- endif -%}

            {%- when 'product' -%}
              {%- assign product       = block.settings.product -%}
              {%- assign product_badge = block.settings.product_badge -%}

              {%- unless products_group -%}
                <div class="products__list">

                {%- assign products_group = true -%}
              {%- endunless -%}

                <div class="products__item" id="{{- block_id -}}">
                  {%- render 'product-card',
                      badge: product_badge,
                      product: product,
                      settings: settings,
                      image_loading: loading_strategy
                  -%}
                </div>

            {%- when 'tagline' -%}
              {%- if products_group -%}
                </div>

                {%- assign products_group = false -%}
              {%- endif -%}

              {%- assign tagline = block.settings.tagline -%}

              {%- if tagline != blank -%}
                <p class="products__tagline tagline" id="{{- block_id -}}">
                  {{- tagline -}}
                </p>
              {%- endif -%}

          {%- endcase -%}
        {%- endfor -%}

        {%- if products_group -%}
          </div>
        {%- endif -%}
      </div>
    </div>
  </div>
{%- endif -%}

{% schema %}
  {
    "name": "Products",
    "tag": "section",
    "class": "products",
    "css_assets": [
      {
        "file": "products.css"
      }
    ],
    "blocks": [
      {
        "type": "description",
        "name": "Description",
        "limit": 1,
        "settings": [
          {
            "type": "header",
            "content": "General settings"
          },
          {
            "type": "contentEditor",
            "id": "description",
            "label": "Text",
            "default": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse varius enim in eros elementum tristique."
          }
        ]
      },
      {
        "type": "heading",
        "name": "Heading",
        "limit": 1,
        "settings": [
          {
            "type": "header",
            "content": "General settings"
          },
          {
            "type": "text",
            "id": "heading",
            "label": "Heading",
            "default": "How it works"
          }
        ]
      },
      {
        "type": "product",
        "name": "Product",
        "limit": 4,
        "settings": [
          {
            "type": "header",
            "content": "General settings"
          },
          {
            "type": "product",
            "id": "product",
            "label": "Product"
          },
          {
            "type": "text",
            "id": "product_badge",
            "label": "Badge",
            "default": "NEW"
          }
        ]
      },
      {
        "type": "tagline",
        "name": "Tagline",
        "limit": 1,
        "settings": [
          {
            "type": "header",
            "content": "General settings"
          },
          {
            "type": "text",
            "id": "tagline",
            "label": "Text",
            "default": "Tagline"
          }
        ]
      }
    ],
    "settings": [
      {
        "type": "header",
        "content": "General settings"
      },
      {
        "type": "color_scheme",
        "id": "color_scheme",
        "label": "Color scheme",
        "default": "set-1"
      },
      {
        "type": "select",
        "id": "content_horizontal",
        "label": "Horizontal positioning",
        "options": [
          {
            "value": "left",
            "label": "Left"
          },
          {
            "value": "center",
            "label": "Center"
          },
          {
            "value": "right",
            "label": "Right"
          }
        ],
        "default": "left"
      },
      {
        "type": "header",
        "content": "Desktop settings"
      },
      {
        "type": "select",
        "id": "padding_top_desktop",
        "label": "Padding top",
        "options": [
          {
            "value": "sm",
            "label": "Small"
          },
          {
            "value": "md",
            "label": "Medium"
          },
          {
            "value": "lg",
            "label": "Large"
          }
        ],
        "default": "lg"
      },
      {
        "type": "select",
        "id": "padding_bottom_desktop",
        "label": "Padding bottom",
        "options": [
          {
            "value": "sm",
            "label": "Small"
          },
          {
            "value": "md",
            "label": "Medium"
          },
          {
            "value": "lg",
            "label": "Large"
          }
        ],
        "default": "lg"
      },
      {
        "type": "select",
        "id": "products_layout",
        "label": "Layout",
        "options": [
          {
            "value": "two",
            "label": "2 columns"
          },
          {
            "value": "three",
            "label": "3 columns"
          }
        ],
        "default": "two"
      },
      {
        "type": "header",
        "content": "Mobile settings"
      },
      {
        "type": "select",
        "id": "padding_top_mobile",
        "label": "Padding top",
        "options": [
          {
            "value": "sm",
            "label": "Small"
          },
          {
            "value": "md",
            "label": "Medium"
          },
          {
            "value": "lg",
            "label": "Large"
          }
        ],
        "default": "md"
      },
      {
        "type": "select",
        "id": "padding_bottom_mobile",
        "label": "Padding bottom",
        "options": [
          {
            "value": "sm",
            "label": "Small"
          },
          {
            "value": "md",
            "label": "Medium"
          },
          {
            "value": "lg",
            "label": "Large"
          }
        ],
        "default": "md"
      }
    ]
  }
{% endschema %}
